---
title: "main-nitesh"
author: "Nitesh Singh Jaswal"
date: "March 26, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(MASS)
library(arm)
library(broom)
```

```{r}
inter.data = read.csv("International-graduate-student-survey-results.csv")
contcode = read.csv("Country-List-Metadata.csv")
# summary(inter.data)
# Q39
acad.experience = rowSums(dplyr::select(inter.data, Q39_1 , Q39_2 , Q39_3 , Q39_4 , Q39_5 , Q39_6 , Q39_7), na.rm = FALSE, dims = 1)/7
# acad.experience = factor(round(acad.experience))

# Q43
acad.challenges =  factor(as.numeric(inter.data$Q43_1 | inter.data$Q43_2 |inter.data$Q43_3 |inter.data$Q43_4 |inter.data$Q43_5 |inter.data$Q43_7))
inter.small = dplyr::select(inter.data, Q2, Q3, Q4, Q5, Q22, Q40, Q41, Q42, Q28)
inter.small$Q39 = acad.experience
inter.small$Q43 = acad.challenges

# Factoring gender
inter.small$Q3 = factor(inter.small$Q3, labels = c("Male", "Female", "Not Specified"))
# Factoring Studies
inter.small$Q5 = factor(inter.small$Q5)
levels(inter.small$Q5) <- c("Life sciences", "Physical sciences", "Engineering", "Mathematics", "Computer science", "Other")
# Factoring countries
inter.small$Q22 = factor(inter.small$Q22)
levels(inter.small$Q5) <- as.vector(contcode)

# Recoding and Factoring the response in order
inter.small$likelihood = recode(inter.small$Q28, `1` = 2, `3` = 1, `2` = 0)
inter.small$likelihood = as.factor(inter.small$likelihood)
levels(inter.small$likelihood) <- c("Unlikely", "Somewhat Likely", "Very Likely")
```
EDA
```{r}
ggplot(inter.small[inter.small$Q3 %in% c("Male", "Female"),], aes(x = Q3)) + stat_count() + facet_wrap(~as.factor(Q5))
```
```{r}
ggplot(inter.small[inter.small$Q3 %in% c("Male", "Female"),], aes(x = Q3)) + stat_count() + facet_wrap(~as.factor(Q5))
```


```{r}
# Acad Challenges vs Response
ggplot(inter.small, aes(x = Q43, y = Q28)) + geom_jitter(width = 0.2, height = 0.2)
# Acad experience vs Response
ggplot(inter.small, aes(x = Q39, y = Q28)) + geom_jitter(width = 0.2, height = 0.2)
# Acad experience and Acad Challenges vs Response
ggplot(inter.small, aes(x = Q39, y = Q43, color = Q28)) + geom_jitter(width = 0.2, height = 0.2)
# Age vs Response
ggplot(inter.small, aes(x = Q2, y = Q28)) + geom_jitter(width = 0.2, height = 0.2)
# Discipline of degree vs response
ggplot(inter.small, aes(x = Q2, y = Q28)) + geom_jitter(width = 0.2, height = 0.2)


ggplot(inter.small, aes(x = Q39, fill = likelihood)) + stat_count()
ggplot(inter.small, aes(x = Q43, fill = Q28)) + stat_count()
# summary(inter.small$Q42)
```
```{r}
# Preliminary model
inter.polr = polr(likelihood~Q39*Q40*Q41*Q43, data = inter.small)
display(inter.polr)
# inter.polr.df = augment(inter.polr)
apply.fitted = fitted.values(inter.polr)[,2] + 2 * fitted.values(inter.polr)[,3]
apply.resid = inter.small$Q28 - apply.fitted
inter.polr.df = data.frame(inter.small, .fitted = apply.fitted, .resid = apply.resid)
# var(inter.polr.df$.fitted)/(var(inter.polr.df$.fitted) + var(inter.polr.df$.resid))
gg = ggplot(inter.polr.df, aes(x = Q43, y = .resid)) + geom_point()
gg + geom_smooth(method.args = list(degree = 1))
```



Questions to ask professor Luen:
1. Can we take mean of multiple discrete variables representing more or less the same parameter and treat it as a continuous variabele? For example, can we aggregate the various parameters representing academic experience and treat that value as a continuous variable representing a sort of academic experience score?
2. Can we use R^2 for polr to explain the variance

Variables to consider (Know of the land):
Age: Q2
Gender: Q3
Degree pursuing: Q4
Discipline of degree: Q5
What is your home country: Q22

Response variable:
Want to remain in US after graduation: Q28 

Predictor Variables:
Academic experience in comparison with your home country: Q39
Treatment by Prof/Colleagues in comparison with your home country: Q40
Treatment by Prof/Colleagues if you went back to your home country: Q41
Adjustment to American educational culture: Q42
Challenges encountered in the US: Q43





