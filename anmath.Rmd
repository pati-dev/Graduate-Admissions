---
title: "STEM grad students"
author: "Ankit Mathur"
date: "4/2/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, tidy = TRUE)
library(tidyverse)
cb_palette = c("#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7", "#E69F00", "#999999")
```

```{r}
country = read.csv("Country-List-Metadata.csv")
# dom = read.csv("Domestic-graduate-student-survey-results.csv")
inter.data = read.csv("International-graduate-student-survey-results.csv")
# Q39
acad.experience <- rowSums(select(inter.data, Q39_1 , Q39_2 , Q39_3 , Q39_4 , Q39_5 , Q39_6 , Q39_7), na.rm = FALSE, dims = 1)/7
# acad.experience = round(acad.experience)
# Q43
acad.challenges =  as.numeric(inter.data$Q43_1 + inter.data$Q43_2 + inter.data$Q43_3 + inter.data$Q43_4 + inter.data$Q43_5 + inter.data$Q43_7)
inter.small = select(inter.data, Q2, Q3, Q4, Q5, Q22, Q36, Q40, Q41, Q42, Q28)
inter.small$Q39 = acad.experience
inter.small$Q43 = ifelse(inter.data$Q43_6, 0, ifelse(acad.challenges<3, 1, 2))
```

```{r}
inter.small$gender <- as.factor(ifelse(inter.small$Q3==1, "Male", ifelse(inter.small$Q3==2, "Female", NA)))
gender_order <- c("Male", "Female")
ggplot(inter.small[!is.na(inter.small$gender),], aes(x=gender)) + stat_count(fill="#E69F00") + theme_bw() +
  ggtitle("Distribution of respondents by gender") +
  scale_x_discrete(limits = gender_order)
```

```{r}
inter.small$degree <- as.factor(ifelse(inter.small$Q4==1, "Master's", "PhD"))
ggplot(inter.small, aes(x=degree)) + stat_count(fill="#56B4E9") + theme_bw() +
  ggtitle("Distribution of respondents by degree")
```

```{r}
inter.small$discipline <- as.factor(ifelse(inter.small$Q5==1, "Life sciences", ifelse(inter.small$Q5==2, "Physical sciences", ifelse(inter.small$Q5==3, "Engineering", ifelse(inter.small$Q5==4, "Mathematics", ifelse(inter.small$Q5==5, "Computer science", "Other"))))))
disc_order <- c("Engineering", "Life sciences", "Computer science", "Physical sciences", "Mathematics", "Other")
ggplot(inter.small, aes(x=discipline)) + stat_count(fill="#009E73") + theme_bw() +
  ggtitle("Distribution of respondents by discipline") +
  scale_x_discrete(limits = disc_order)
```

```{r}
inter.small$country <- as.factor(ifelse(inter.small$Q22==44, "China", ifelse(inter.small$Q22==91, "India", "Other")))
country_order <- c("China", "India", "Other")
ggplot(inter.small, aes(x=country)) + stat_count(fill="#F0E442") + theme_bw() +
  ggtitle("Distribution of respondents by country") +
  scale_x_discrete(limits = country_order)
```

```{r}
inter.small$likelihood = recode(inter.small$Q28, `1` = 2, `3` = 1, `2` = 0)
inter.small$likelihood = as.factor(inter.small$likelihood)
levels(inter.small$likelihood) <- c("Unlikely", "Somewhat likely", "Very likely")
```

```{r}
ggplot(inter.small[!is.na(inter.small$gender),], aes(x=Q40, color=gender, fill=gender)) +
  geom_bar(mapping = aes(x = Q40, y = ..prop.., group = 1), stat = "count") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  facet_wrap(~gender) +
  guides(fill = guide_legend(title="Sex"), color = FALSE) +
  ggtitle("Treatment by colleagues and professors in the US as compared to home country") +
  labs(caption="Values: 1. Much worse  2. Somewhat worse  3. Neither better nor worse \n  4. Somewhat better  5. Much better") +
  xlab("Response") + ylab("Proportion of students (%)") +
  theme_bw() + scale_fill_manual(values=cb_palette) + scale_color_manual(values=cb_palette)
```

```{r}
ggplot(inter.small[!is.na(inter.small$degree),], aes(x=Q40, color=degree, fill=degree)) +
  geom_bar(mapping = aes(x = Q40, y = ..prop.., group = 1), stat = "count") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  facet_wrap(~degree) +
  guides(fill = guide_legend(title="Degree"), color = FALSE) +
  ggtitle("Treatment by colleagues and professors in the US as compared to home country") +
  labs(caption="Values: 1. Much worse  2. Somewhat worse  3. Neither better nor worse \n  4. Somewhat better  5. Much better") +
  xlab("Response") + ylab("Proportion of students (%)") +
  theme_bw() + scale_fill_manual(values=cb_palette) + scale_color_manual(values=cb_palette)
```

```{r}
ggplot(inter.small[!is.na(inter.small$discipline),], aes(x=Q40, color=discipline, fill=discipline)) +
  geom_bar(mapping = aes(x = Q40, y = ..prop.., group = 1), stat = "count") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  facet_wrap(~discipline) +
  guides(fill = guide_legend(title="Discipline"), color = FALSE) +
  ggtitle("Treatment by colleagues and professors in the US as compared to home country") +
  labs(caption="Values: 1. Much worse  2. Somewhat worse  3. Neither better nor worse \n  4. Somewhat better  5. Much better") +
  xlab("Response") + ylab("Proportion of students (%)") +
  theme_bw() + scale_fill_manual(values=cb_palette) + scale_color_manual(values=cb_palette)
```

```{r}
ggplot(inter.small[!is.na(inter.small$country),], aes(x=Q40, color=country, fill=country)) +
  geom_bar(mapping = aes(x = Q40, y = ..prop.., group = 1), stat = "count") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  facet_wrap(~country) +
  guides(fill = guide_legend(title="Country"), color = FALSE) +
  ggtitle("Treatment by colleagues and professors in the US as compared to home country") +
  labs(caption="Values: 1. Much worse  2. Somewhat worse  3. Neither better nor worse \n  4. Somewhat better  5. Much better") +
  xlab("Response") + ylab("Proportion of students (%)") +
  theme_bw() + scale_fill_manual(values=cb_palette) + scale_color_manual(values=cb_palette)
```

```{r}
ggplot(inter.small[!is.na(inter.small$gender),], aes(x=Q41, color=gender, fill=gender)) +
  geom_bar(mapping = aes(x = Q41, y = ..prop.., group = 1), stat = "count") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  facet_wrap(~gender) +
  guides(fill = guide_legend(title="Sex"), color = FALSE) +
  ggtitle("Expectation of treatment by colleagues and professors in home country if returned") +
  labs(caption="Values: 1. Much worse  2. Somewhat worse  3. Neither better nor worse \n  4. Somewhat better  5. Much better") +
  xlab("Response") + ylab("Proportion of students (%)") +
  theme_bw() + scale_fill_manual(values=cb_palette) + scale_color_manual(values=cb_palette)
```

```{r}
ggplot(inter.small[!is.na(inter.small$degree),], aes(x=Q41, color=degree, fill=degree)) +
  geom_bar(mapping = aes(x = Q41, y = ..prop.., group = 1), stat = "count") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  facet_wrap(~degree) +
  guides(fill = guide_legend(title="Degree"), color = FALSE) +
  ggtitle("Expected treatment by colleagues and professors in home country on return") +
  labs(caption="Values: 1. Much worse  2. Somewhat worse  3. Neither better nor worse \n  4. Somewhat better  5. Much better") +
  xlab("Response") + ylab("Proportion of students (%)") +
  theme_bw() + scale_fill_manual(values=cb_palette) + scale_color_manual(values=cb_palette)
```

As compared to PhD students, Master's students feel that they will be treated better by their colleagues and professors in their home country if they were to return after their graduation.

```{r}
ggplot(inter.small[!is.na(inter.small$discipline),], aes(x=Q41, color=discipline, fill=discipline)) +
  geom_bar(mapping = aes(x = Q41, y = ..prop.., group = 1), stat = "count") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  facet_wrap(~discipline) +
  guides(fill = guide_legend(title="Discipline"), color = FALSE) +
  ggtitle("Expectation of treatment by colleagues and professors in home country if returned") +
  labs(caption="Values: 1. Much worse  2. Somewhat worse  3. Neither better nor worse \n  4. Somewhat better  5. Much better") +
  xlab("Response") + ylab("Proportion of students (%)") +
  theme_bw() + scale_fill_manual(values=cb_palette) + scale_color_manual(values=cb_palette)
```

```{r}
ggplot(inter.small[!is.na(inter.small$country),], aes(x=Q41, color=country, fill=country)) +
  geom_bar(mapping = aes(x = Q41, y = ..prop.., group = 1), stat = "count") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  facet_wrap(~country) +
  guides(fill = guide_legend(title="Country"), color = FALSE) +
  ggtitle("Expectation of treatment by colleagues and professors in home country if returned") +
  labs(caption="Values: 1. Much worse  2. Somewhat worse  3. Neither better nor worse \n  4. Somewhat better  5. Much better") +
  xlab("Response") + ylab("Proportion of students (%)") +
  theme_bw() + scale_fill_manual(values=cb_palette) + scale_color_manual(values=cb_palette)
```

```{r}
ggplot(inter.small[!is.na(inter.small$gender),], aes(x=Q42, color=gender, fill=gender)) +
  geom_bar(mapping = aes(x = Q42, y = ..prop.., group = 1), stat = "count") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  facet_wrap(~gender) +
  guides(fill = guide_legend(title="Sex"), color = FALSE) +
  ggtitle("Adjustment to American culture") +
  labs(caption="Response values scaled from 1 meaning Did not adjust well to 5 meaning Adjusted well") +
  xlab("Response") + ylab("Proportion of students (%)") +
  theme_bw() + scale_fill_manual(values=cb_palette) + scale_color_manual(values=cb_palette)
```

```{r}
ggplot(inter.small[!is.na(inter.small$degree),], aes(x=Q42, color=degree, fill=degree)) +
  geom_bar(mapping = aes(x = Q42, y = ..prop.., group = 1), stat = "count") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  facet_wrap(~degree) +
  guides(fill = guide_legend(title="Degree"), color = FALSE) +
  ggtitle("Adjustment to American culture") +
  labs(caption="Response values scaled from 1 meaning Did not adjust well to 5 meaning Adjusted well") +
  xlab("Response") + ylab("Proportion of students (%)") +
  theme_bw() + scale_fill_manual(values=cb_palette) + scale_color_manual(values=cb_palette)
```


```{r}
ggplot(inter.small[!is.na(inter.small$discipline),], aes(x=Q42, color=discipline, fill=discipline)) +
  geom_bar(mapping = aes(x = Q42, y = ..prop.., group = 1), stat = "count") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  facet_wrap(~discipline) +
  guides(fill = guide_legend(title="Discipline"), color = FALSE) +
  ggtitle("Adjustment to American culture") +
  labs(caption="Response values scaled from 1 meaning Did not adjust well to 5 meaning Adjusted well") +
  xlab("Response") + ylab("Proportion of students (%)") +
  theme_bw() + scale_fill_manual(values=cb_palette) + scale_color_manual(values=cb_palette)
```

```{r}
ggplot(inter.small[!is.na(inter.small$country),], aes(x=Q42, color=country, fill=country)) +
  geom_bar(mapping = aes(x = Q42, y = ..prop.., group = 1), stat = "count") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  facet_wrap(~country) +
  guides(fill = guide_legend(title="Country"), color = FALSE) +
  ggtitle("Adjustment to American culture") +
  labs(caption="Response values scaled from 1 meaning Did not adjust well to 5 meaning Adjusted well") +
  xlab("Response") + ylab("Proportion of students (%)") +
  theme_bw() + scale_fill_manual(values=cb_palette) + scale_color_manual(values=cb_palette)
```

```{r}
ggplot(inter.small[!is.na(inter.small$gender),], aes(x=Q43, color=gender, fill=gender)) +
  geom_bar(mapping = aes(x = Q43, y = ..prop.., group = 1), stat = "count") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  facet_wrap(~gender) +
  guides(fill = guide_legend(title="Sex"), color = FALSE) +
  ggtitle("Challenges encountered in the US") +
  labs(caption="Response values: 0: Did not face any challenges 1: Faced some challenges \n2: Faced a lot of challenges") +
  xlab("Response") + ylab("Proportion of students (%)") +
  theme_bw() + scale_fill_manual(values=cb_palette) + scale_color_manual(values=cb_palette)
```

A higher percentage of female students faced a lot of challenges while adjusting to American culture as compared to their male counterparts.

```{r}
ggplot(inter.small[!is.na(inter.small$degree),], aes(x=Q43, color=degree, fill=degree)) +
  geom_bar(mapping = aes(x = Q43, y = ..prop.., group = 1), stat = "count") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  facet_wrap(~degree) +
  guides(fill = guide_legend(title="Degree"), color = FALSE) +
  ggtitle("Challenges encountered in the US") +
  labs(caption="Response values: 0: Did not face any challenges 1: Faced some challenges \n2: Faced a lot of challenges") +
  xlab("Response") + ylab("Proportion of students (%)") +
  theme_bw() + scale_fill_manual(values=cb_palette) + scale_color_manual(values=cb_palette)
```


```{r}
ggplot(inter.small[!is.na(inter.small$discipline),], aes(x=Q43, color=discipline, fill=discipline)) +
  geom_bar(mapping = aes(x = Q43, y = ..prop.., group = 1), stat = "count") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  facet_wrap(~discipline) +
  guides(fill = guide_legend(title="Discipline"), color = FALSE) +
  ggtitle("Challenges encountered in the US") +
  labs(caption="Response values: 0: Did not face any challenges 1: Faced some challenges \n2: Faced a lot of challenges") +
  xlab("Response") + ylab("Proportion of students (%)") +
  theme_bw() + scale_fill_manual(values=cb_palette) + scale_color_manual(values=cb_palette)
```

Students in other disciplines face a lot of challenges as compared to their counterparts in computer science, engineering, life sciences, physical sciences, and mathematics disciplines.

```{r}
ggplot(inter.small[!is.na(inter.small$country),], aes(x=Q43, color=country, fill=country)) +
  geom_bar(mapping = aes(x = Q43, y = ..prop.., group = 1), stat = "count") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  facet_wrap(~country) +
  guides(fill = guide_legend(title="Country"), color = FALSE) +
  ggtitle("Challenges encountered in the US") +
  labs(caption="Response values: 0: Did not face any challenges 1: Faced some challenges \n2: Faced a lot of challenges") +
  xlab("Response") + ylab("Proportion of students (%)") +
  theme_bw() + scale_fill_manual(values=cb_palette) + scale_color_manual(values=cb_palette)
```


```{r}
aggregate(Q40 ~ Q43, data=inter.small, length)
```


```{r}
ggplot(inter.small[!is.na(inter.small$gender),], aes(x = Q39, ..count.., fill = likelihood)) + 
  geom_density(position = "fill") + 
  ggtitle("Likelihood of staying in the US after graduation") + 
  scale_fill_manual(values = cb_palette) +
  facet_wrap(~gender)
```

```{r}
ggplot(inter.small, aes(x = Q40, ..count.., fill = likelihood)) + stat_count(position = "fill") + ggtitle("Likelihood of staying in the US after graduation") + scale_fill_manual(values = cb_palette)
```

```{r}
ggplot(inter.small, aes(x = Q41, ..count.., fill = likelihood)) + stat_count(position = "fill") + ggtitle("Likelihood of staying in the US after graduation") + scale_fill_manual(values = cb_palette)
```

```{r}
ggplot(inter.small, aes(x = Q42, ..count.., fill = likelihood)) + stat_count(position = "fill") + ggtitle("Likelihood of staying in the US after graduation") + scale_fill_manual(values = cb_palette)
```

```{r}
ggplot(inter.small, aes(x = Q43, ..count.., fill = likelihood)) + stat_count(position = "fill") + ggtitle("Likelihood of staying in the US after graduation") + scale_fill_manual(values = cb_palette)
```

```{r}
ggplot(inter.small, aes(x = Q36, ..count.., fill = likelihood)) + stat_count(position = "fill") + ggtitle("Likelihood of staying in the US after graduation") + scale_fill_manual(values = cb_palette)
```


```{r}
summary(factor(inter.data$Q22))
```
